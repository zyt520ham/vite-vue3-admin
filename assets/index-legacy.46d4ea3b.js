System.register(["./index-legacy.aac41f3b.js","./index-legacy.264872e2.js","./dynamic-table-legacy.8ef9fd3f.js","./index-legacy.a269a9e3.js","./useFormModal-legacy.e311fac9.js","./PoweroffOutlined-legacy.c57472b9.js","./VerticalRightOutlined-legacy.1a523a78.js","./schema-form-legacy.96d5fb11.js","./index-legacy.15a8075d.js","./isNumeric-legacy.c66a90f9.js"],(function(e){"use strict";var t,a,n,l,r,o,i,s,d,c,u,m,f,p,b,y,h,g,v,w,I,k,P,O,j;return{setters:[function(e){t=e.c,a=e.A,n=e.aG,l=e.b5,r=e.cz,o=e.d,i=e.Y,s=e.N,d=e.O,c=e.a7,u=e.$,m=e.a8,f=e.a9,p=e.Z,b=e.ay,y=e.U,h=e.ah,g=e.bs},function(e){v=e.D},function(e){w=e.u,I=e.P},function(e){k=e.B,P=e.R},function(e){O=e.u},function(e){j=e.P},function(){},function(){},function(){},function(){}],execute:function(){k.install=function(e){return e.component(k.name,k),e.component(P.name,P),e};var x={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){T(e,t,a[t])}))}return e}function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _=function(e,n){var l=C({},e,n.attrs);return t(a,C({},l,{icon:x}),null)};_.displayName="CaretRightOutlined",_.inheritAttrs=!1;var $=_,M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M876.6 239.5c-.5-.9-1.2-1.8-2-2.5-5-5-13.1-5-18.1 0L684.2 409.3l-67.9-67.9L788.7 169c.8-.8 1.4-1.6 2-2.5 3.6-6.1 1.6-13.9-4.5-17.5-98.2-58-226.8-44.7-311.3 39.7-67 67-89.2 162-66.5 247.4l-293 293c-3 3-2.8 7.9.3 11l169.7 169.7c3.1 3.1 8.1 3.3 11 .3l292.9-292.9c85.5 22.8 180.5.7 247.6-66.4 84.4-84.5 97.7-213.1 39.7-311.3zM786 499.8c-58.1 58.1-145.3 69.3-214.6 33.6l-8.8 8.8-.1-.1-274 274.1-79.2-79.2 230.1-230.1s0 .1.1.1l52.8-52.8c-35.7-69.3-24.5-156.5 33.6-214.6a184.2 184.2 0 01144-53.5L537 318.9a32.05 32.05 0 000 45.3l124.5 124.5a32.05 32.05 0 0045.3 0l132.8-132.8c3.7 51.8-14.4 104.8-53.6 143.9z"}}]},name:"tool",theme:"outlined"};function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){z(e,t,a[t])}))}return e}function z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var q=function(e,n){var l=S({},e,n.attrs);return t(a,S({},l,{icon:M}),null)};q.displayName="ToolOutlined",q.inheritAttrs=!1;var R=q;const N=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},V=e=>{switch(e){case 0:return"停止";case 1:return"运行"}},D=[{title:"任务名称",dataIndex:"name",width:240},{title:"状态",width:120,dataIndex:"status",align:"center",bodyCell:({record:e})=>t(k,{status:1===e.status?"processing":"default",color:N(e.status),text:V(e.status)},null)},{title:"类型",width:100,align:"center",dataIndex:"type",bodyCell:({record:e})=>t(n,{color:"processing"},{default:()=>[1===e.type?"Interval":"Cron"]})},{title:"调用服务",dataIndex:"service",hideInSearch:!0,align:"center",width:350},{title:"执行参数",dataIndex:"data",align:"center",hideInSearch:!0,width:450},{title:"备注",width:250,align:"center",dataIndex:"remark"}],A=[{field:"type",component:"RadioGroup",label:"名称",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"时间间隔",value:1}]}},{field:"name",component:"Input",label:"任务名称",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"服务路径",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"请输入调用服务的路径"}},{field:"data",component:"Input",label:"任务参数",componentProps:{placeholder:"请输入任务参数（可不填）"}},{field:"limit",component:"InputNumber",label:"执行次数",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>0===e.type,componentProps:{placeholder:"请输入Cron表达式"}},{field:"every",component:"InputNumber",label:"执行间隔",defaultValue:6e4,vIf:({formModel:e})=>1===e.type,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"开始时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"结束时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",defaultValue:1,label:"状态",componentProps:{options:[{label:"运行",value:1},{label:"停止",value:0}]}}];function L(e){return l({url:r.page,method:"get",params:e})}function B(e){return l({url:r.add,method:"post",data:e},{successMsg:"添加成功"})}function F(e){return l({url:r.update,method:"post",data:e},{successMsg:"修改成功"})}const G=m(" 新增 "),E=m("秒 分 小时 日期 月份 星期 年(可选)"),U=m("仅一次 "),W=m("运行 "),Y=m("停止 ");e("default",o({name:"SystemScheduleTask",setup(e){const[a,n]=w({search:!1,size:"small"}),[o]=O(),k=()=>null==n?void 0:n.reload(),P=async e=>{const[t]=await o({modalProps:{title:(e.id?"编辑":"新增")+"任务",width:640,onFinish:async t=>{const a={...t,id:e.id};console.log("新增/编辑任务",a),await(e.id?F:B)(a),k()}},formProps:{labelWidth:100,schemas:A}});if(e.id){const n=await(a={id:e.id},l({url:r.info,method:"get",params:a}));null==t||t.setFieldsValue({...e,...n})}var a},x=async e=>{var t;await(t={id:e},l({url:r.delete,method:"post",data:t})),k()},C=async e=>{var t;await(t={id:e.id},l({url:r.once,method:"post",data:t})),k()},T=async e=>{var t;await(t={id:e.id},l({url:r.start,method:"post",data:t})),k()},_=async e=>{var t;await(t={id:e.id},l({url:r.stop,method:"post",data:t})),k()},M=e=>e.startTime||e.endTime?!e.startTime&&e.endTime?`无开始时间限制 - ${e.endTime}`:e.startTime&&!e.endTime?`${e.startTime} - 长期有效`:`${e.startTime} - ${e.endTime}`:"无时段限制",S=[...D,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.task.update",effect:"disable"},onClick:()=>P(e)},{label:"删除",auth:"sys.task.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>x(e.id)}}]}];return(e,n)=>{const l=i("a-button");return s(),d("div",null,[t(u(a),{"row-key":"id","header-title":"定时任务","data-request":u(L),columns:S,scroll:{x:2e3},bordered:""},{toolbar:c((()=>[t(l,{type:"primary",disabled:!e.$auth("sys.task.add"),onClick:n[0]||(n[0]=e=>P({}))},{default:c((()=>[G])),_:1},8,["disabled"])])),expandedRowRender:c((({record:a})=>[t(u(v),{column:1},{default:c((()=>[t(u(v).Item,{label:"任务编号"},{default:c((()=>[m("# "+f(a.id),1)])),_:2},1024),t(u(v).Item,{label:"执行次数"},{default:c((()=>[m(f(a.limit>0?`仅 ${a.limit} 次`:"无次数限制"),1)])),_:2},1024),1===a.type?(s(),p(u(v).Item,{key:0,label:"执行间隔"},{default:c((()=>[m(" 每"+f(a.every)+"毫秒执行一次 ",1)])),_:2},1024)):(s(),p(u(v).Item,{key:1,label:"Cron表达式"},{default:c((()=>[t(u(b),null,{title:c((()=>[E])),default:c((()=>[m(" "+f(a.cron),1)])),_:2},1024)])),_:2},1024)),0===a.type?(s(),p(u(v).Item,{key:2,label:"执行时间段"},{default:c((()=>[y("span",null,f(M(a)),1)])),_:2},1024)):h("",!0),t(u(v).Item,{label:"执行操作"},{default:c((()=>[t(u(I),{title:"确认手动执行一次该任务吗?",disabled:!e.$auth("sys.task.once"),onConfirm:e=>C(a)},{default:c((()=>[t(u(g),{type:"link",size:"small",disabled:!e.$auth("sys.task.once")},{icon:c((()=>[t(u(R))])),default:c((()=>[U])),_:1},8,["disabled"])])),_:2},1032,["disabled","onConfirm"]),t(u(I),{title:"确认运行该任务吗?",disabled:!(e.$auth("sys.task.start")&&0===a.status),onConfirm:e=>T(a)},{default:c((()=>[t(u(g),{type:"link",size:"small",disabled:!(e.$auth("sys.task.start")&&0===a.status)},{icon:c((()=>[t(u($))])),default:c((()=>[W])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"]),t(u(I),{title:"确认停止该任务吗?",disabled:!(e.$auth("sys.task.stop")&&1===a.status),onConfirm:e=>_(a)},{default:c((()=>[t(u(g),{type:"link",size:"small",disabled:!(e.$auth("sys.task.stop")&&1===a.status)},{icon:c((()=>[t(u(j))])),default:c((()=>[Y])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"])])),_:2},1024)])),_:2},1024)])),_:1},8,["data-request"])])}}}))}}}));
